---
layout: post
title: "博客新增阅读书单和观影列表子栏目"
description: "阅读书单 观影列表"
categories: [子在川上曰：我在写代码【动手动脚篇】]
tags: [Python]
music: []
image: /assets/images/2014-10-23-readinglist.jpg

---

前天下午无意中看到一个博客中的阅读书单栏目，觉得把自己读过的或准备读的书记录下来是一个很好的想法，于是决定在我这里也模仿实现一个。用了一天时间，现在基本上完成啦。

<!-- more -->

犹豫平时闲暇时间更多的用来看电影了<img src="http://cubernet.cn/assets/smilies/5.gif"id="smiley">，所以又特意增加了一个记录电影的子栏目。以后大家就可以通过电脑（出于排版优化的问题，手机访问时左边的导航栏默认是不显示的）访问我博客的[阅读书单](http://cubernet.cn/books/)和[观影列表](http://cubernet.cn/movies/)来与我交流分享好看的书或者电影了。

这一天的时间里，整理资料和编写代码的时间基本上一半一半吧。先说整理资料的事情。

由于电影基本上都是陪女朋友一起去电影院看的，而且我们有收集电影票的习惯，所以如果只是简单的列出条目应该比较简单。但是书单就没这么容易了。小说类的图书基本上都是看的电子版，看过就删，所以现在已经很难想起这几年看过哪些小说了。技术类的图书基本都是买正版纸质书，所以列出来的也算比较全。唯一遗憾的是很多书都是读了一半就放在一边了。这个毛病要改正，那些没读完的书，也要抽时间一点一点读完。

重点说这个书单和观影列表技术实现方面的事情。

首先是网页模板这边的工作量。每个子栏目都需要建立一个总的统计页面，每个具体的列表页面，也和普通博文的页面样式不同。所以首先给这两类页面写了相应的模板，保存在_layouts文件夹下。然后在css文件中调整页面布局，最后在手机端测试，做手机端的浏览优化。整个流程下来，耗时约两小时。

当我私以为小屋已经搭好，马上就可以上线时才发现，书单内容和电影详情的录入是一件多么耗时耗力的事情。再加上栏目建立初期，需要同时统计过去几年内的东西，想起来就觉得可怕。

不过一想到万事开头难，便咬着牙开始一一录入。又过了不知好久，书单详情录入完毕。发布，刷新，恩，效果还算满意。<img src="http://cubernet.cn/assets/smilies/10.gif"id="smiley">

可是再当我录入一个电影详情再做测试时，发现图片竟然加载不了。一研究，原来是豆瓣电影对图片做了防盗链，页面上所有引用豆瓣电影的图片全部显示为X<img src="http://cubernet.cn/assets/smilies/15.gif"id="smiley">。没想到同属豆瓣，豆瓣读书和豆瓣电影竟然对图片的处理上相差了这么多，不知道是因为背后的技术团队不同还是出于版权的考虑。总之，对我而言，豆瓣的图我是没办法用了。如果说手动复制粘贴链接还能忍受的话，那么每个图片都要手动寻找链接，然后下载，然后改名、另存为，最后把本地链接写到页面上，这么一套全部手工实现的话，我想接下来这一周我都有事情做了。所以，我又自然而然的操起老本行，用爬虫帮我下载。

既然决定写脚本，不如全部工作就都由脚本来实现好了。于是有了如下的脚本：

![image](/assets/images/2014-10-23-readinglist2.png)

脚本的源码可以在我github库中下载。简单说下实现思路及功能：

功能：

* 根据输入的电影名称，自动在豆瓣电影中搜索该电影
* 从搜索结果中自动提取该电影的导演、主演等信息
* 根据输入的年份，将提取到的电影信息按到指定的格式追加写入到对应年份观影列表的.md文件中
* 将该电影的主题海报自动下载并归类保存在posters文件夹中，并将生成的链接加入到.md文件中

实现思路：

* Python脚本实现
* 最基本的根据指定url爬取对应页面内容
* 将爬虫访问行为伪装成用户的浏览器访问行为
* 正则表达式提取关键字段
* 读取本地文件，并在指定位置追加写入新的内容
* Python脚本命令行参数读取

最终实现的效果是，我只需要`python douban.py -y 2014 -n 心花怒放 -p xhnf`这么一行命令，即可完成`心花怒放`的信息爬取、海报下载和观影列表文件内容的自动填充。于是，我用了几分钟，完成了三十多部电影信息的添加<img src="http://cubernet.cn/assets/smilies/28.gif"id="smiley">。

记得有人说过，人和猿最大的区别是是否懂得使用工具。我一直以为这句话的另一种表达方式是人会使用工具而猿不会。

看来我理解反了。<img src="http://cubernet.cn/assets/smilies/38.gif"id="smiley">


